<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Flag Football — Clean Plays + Rotations</title>
<style>
  :root{
    --bg:#0b0f14; --card:#121820; --ink:#eaf2ff; --muted:#a9b8cc; --accent:#66b2ff;
    --field-green:#2e7d32; --field-green-dark:#1b5e20; --field-line:#e0f2f1;
    --qb:#1e88e5; --center:#6d4c41; --wr:#f4511e; --slot:#fbc02d; --rb:#8e24aa; --flex:#26a69a;
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);color:var(--ink)}
  header{padding:14px 16px;border-bottom:1px solid #1e2835}
  h1{margin:0;font-size:18px} .sub{font-size:12px;color:var(--muted)}
  nav{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
  nav button{padding:8px 10px;border-radius:10px;background:#101522;border:1px solid #2a3a4f;color:var(--ink);cursor:pointer}
  nav button.active{background:var(--accent);color:#002b55;border-color:var(--accent)}
  main{padding:12px;max-width:1100px;margin:0 auto}
  .panel{background:var(--card);border:1px solid #1e2835;border-radius:12px;padding:12px;margin:10px 0}
  .controls{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
  select,input,button{background:#101522;color:var(--ink);border:1px solid #25405f;border-radius:10px;padding:10px 12px}
  button.primary{background:var(--accent);color:#002b55;border-color:var(--accent);font-weight:700;cursor:pointer}
  .pill{display:inline-block;padding:2px 8px;border-radius:999px;border:1px solid #3b4d66;color:#a9b8cc;font-size:12px}
  .row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
  .muted{color:#a9b8cc;font-size:12px}

  /* Board tiles */
  .assign{display:grid;grid-template-columns:repeat(2,1fr);gap:8px;margin-top:16px}
  @media(min-width:520px){.assign{grid-template-columns:repeat(3,1fr)}}
  .tile{border-radius:12px;padding:12px;border:1px solid #2a3a4f}
  .tile h4{margin:0 0 6px 0;font-size:14px;color:#a9b8cc}
  .big{font-size:28px;font-weight:800}
  .role-QB{background:#1e88e520;border-color:#1f4d80}
  .role-C{background:#6d4c4120;border-color:#5d4037}
  .role-WR1,.role-WR2,.role-WR3{background:#f4511e20;border-color:#d84315}
  .role-RB{background:#8e24aa20;border-color:#6a1b9a}
  .role-Flex{background:#26a69a20;border-color:#0d6b62}

  /* Field + routes - proper dimensions */
  .field-wrap{background:linear-gradient(180deg,var(--field-green),var(--field-green-dark));border-radius:12px;padding:8px;border:2px solid #123814}
  .field{height:400px;position:relative;background:
    repeating-linear-gradient(to bottom, transparent 0, transparent 38px, rgba(255,255,255,.12) 38px, rgba(255,255,255,.12) 40px);
    border-radius:10px}
  .sideline{position:absolute;inset:0;box-shadow:inset 0 0 0 3px var(--field-line);border-radius:10px}
  svg{width:100%;height:100%;display:block}
  .player{stroke:#0008;stroke-width:1.2px}
  .bubble{font-size:14px;font-weight:800;fill:#fff;paint-order:stroke;stroke:#000;stroke-width:1.5px}
  .role-lbl{font-size:10px;fill:#fff;paint-order:stroke;stroke:#000;stroke-width:.6px}
  .route{fill:none;stroke:#fff;stroke-width:3;stroke-linecap:round;stroke-linejoin:round;marker-end:url(#arrow)}
  .route.alt{stroke:#ffeb3b;marker-end:url(#arrowAlt)}

  .grid{display:grid;grid-template-columns:1fr;gap:10px}
  @media(min-width:900px){.grid{grid-template-columns:1fr 1fr}}
  table{width:100%;border-collapse:collapse;font-size:13px}
  th,td{border:1px solid #2a3a4f;padding:6px;text-align:center}
  th{background:#101522}
</style>
</head>
<body>
<header>
  <h1>Flag Football — Clean Plays + Rotations</h1>
  <div class="sub">Rosters: 7–10 • Formats: 5v5 / 6v6 / 7v7 • Bench-group subs • 10 plays</div>
  <nav>
    <button class="tab active" data-tab="board">Board</button>
    <button class="tab" data-tab="plays">Plays</button>
    <button class="tab" data-tab="rotations">Rotations</button>
    <button class="tab" data-tab="tips">Tips</button>
  </nav>
</header>

<main>
  <div class="panel">
    <div class="controls">
      <label>Format
        <select id="format">
          <option value="5">5v5</option>
          <option value="6" selected>6v6</option>
          <option value="7">7v7</option>
        </select>
      </label>
      <label>Roster
        <select id="roster">
          <option>7</option><option selected>8</option><option>9</option><option>10</option>
        </select>
      </label>
      <label>Identifiers
        <select id="idMode">
          <option value="number" selected>Player #</option>
          <option value="initials">Initials</option>
          <option value="off">Off</option>
        </select>
      </label>
      <label>Mirror
        <select id="mirror">
          <option value="R" selected>Right</option>
          <option value="L">Left</option>
        </select>
      </label>
      <div class="row">
        <button class="primary" id="prevBtn">◀ Prev</button>
        <button class="primary" id="nextBtn">Next ▶</button>
      </div>
    </div>
    <details style="margin-top:6px">
      <summary>Optional: map player # → initials</summary>
      <div id="initials" class="row" style="margin-top:6px"></div>
    </details>
    <div class="muted" id="meta">Series 1 of N • Bench this series: —</div>
  </div>

  <!-- BOARD -->
  <section id="board" class="panel">
    <div class="assign" id="assignGrid"></div>
    <div class="muted" id="benchRow" style="margin-top:10px">Bench: —</div>
  </section>

  <!-- PLAYS -->
  <section id="plays" class="panel" style="display:none">
    <div class="row"><span class="pill">10 plays • Hitch/Slant/Out/Post/Corner/Fly + RB Flat/Swing/Wheel/Check</span></div>
    <div class="grid" id="playGrid"></div>
  </section>

  <!-- ROTATIONS -->
  <section id="rotations" class="panel" style="display:none">
    <h3>Equal-time Rotation (Bench-Group Subs)</h3>
    <div class="muted" style="margin-bottom:6px">
      Bench count = roster − on-field. Those players sit together and groups cycle. Active positions rotate so everyone gets QB.
    </div>
    <div id="rotationTable"></div>
  </section>

  <!-- TIPS -->
  <section id="tips" class="panel" style="display:none">
    <h3>Game Management</h3>
    <ul>
      <li><b>Series flow:</b> Same series plays both ways. On change of possession, tap <b>Next ▶</b> to sub the next bench group.</li>
      <li><b>Position rotation:</b> Kids rotate through all positions including QB for equal playing time.</li>
      <li><b>Mirror:</b> Flip left/right without changing assignments.</li>
      <li><b>Simple calls:</b> Use position names kids understand: QB, Center, WR1, WR2, WR3, RB.</li>
    </ul>
  </section>
</main>

<script>
  const $ = s=>document.querySelector(s);
  const $$ = s=>Array.from(document.querySelectorAll(s));

  /* ===== Base positions - proper field depth ===== */
  // viewBox 600x400 for better depth perception
  const POS_BASE = [
    {key:"QB",   displayName:"QB",   color:"var(--qb)",    x:300, y:340},
    {key:"C",    displayName:"C",    color:"var(--center)",x:300, y:300},
    {key:"WR1",  displayName:"WR1",  color:"var(--wr)",    x:150, y:300}, // left WR
    {key:"WR2",  displayName:"WR2",  color:"var(--wr)",    x:450, y:300}, // right WR  
    {key:"WR3",  displayName:"WR3",  color:"var(--slot)",  x:220, y:320}, // slot
    {key:"RB",   displayName:"RB",   color:"var(--rb)",    x:380, y:320},
    {key:"Flex", displayName:"Flex", color:"var(--flex)",  x:300, y:270}  // 7v7 only
  ];

  function keysForFormat(fmt){
    if(fmt==5) return ["QB","C","WR1","WR2","RB"];
    if(fmt==6) return ["QB","C","WR1","WR2","WR3","RB"];
    return ["QB","C","WR1","WR2","WR3","RB","Flex"];
  }

  /* ===== Route library with proper dimensions =====
     Better scale for field depth:
     5y ≈ 50px, 10y ≈ 100px, 15y ≈ 150px, 20y ≈ 200px
  */
  const OFF = { up:20, side:20 };
  const YD = { y5:50, y10:100, y15:150, y20:200 };

  const R = {
    // WR routes
    HITCH:(x,y)=>[`M${x} ${y-OFF.up} V${y-YD.y10} L${x-25} ${y-YD.y10+20}`],
    SLANT:(x,y)=>[`M${x+OFF.side} ${y} L${x+120} ${y-80}`],
    OUT10:(x,y)=>[`M${x} ${y-OFF.up} V${y-YD.y10} H${x+150}`],
    POST:(x,y)=>[`M${x} ${y-OFF.up} V${y-YD.y10} L${x+100} ${y-YD.y20}`],
    CORNER:(x,y)=>[`M${x} ${y-OFF.up} V${y-YD.y10} L${x+100} ${y-YD.y5}`],
    FLY:(x,y)=>[`M${x} ${y-OFF.up} V${y-YD.y20}`],
    // RB + Center routes
    FLAT:(x,y)=>[`M${x+OFF.side} ${y} H${x+160}`],
    SWING:(x,y)=>[`M${x+OFF.side} ${y} C${x+40} ${y} ${x+100} ${y-20} ${x+180} ${y-40}`],
    WHEEL:(x,y)=>[`M${x+OFF.side} ${y} H${x+100} C${x+140} ${y-20} ${x+140} ${y-80} ${x+140} ${y-YD.y15}`],
    CHECK:(x,y)=>[`M${x} ${y-OFF.up} L${x-25} ${y-25} L${x} ${y-40}`],
    C_SIT:(x,y)=>[`M${x} ${y-OFF.up} V${y-60}`],
    C_SLANT:(x,y)=>[`M${x} ${y-OFF.up} L${x+80} ${y-60}`],
    // Special: cross behind QB for that sweet play you mentioned!
    CROSS_BEHIND:(x,y)=>[`M${x-OFF.side} ${y} C${x-60} ${y+20} ${x} ${y+40} ${x+160} ${y+40}`]
  };

  function mirroredX(x){ return ($("#mirror").value==="L") ? (600 - x) : x; }
  function P(key){ const p=POS_BASE.find(pp=>pp.key===key); return {...p, x:mirroredX(p.x)}; }
  function segs(routeFn, key){ const {x,y}=P(key); return routeFn(x,y); }

  /* ===== SVG defs: smaller arrowheads ===== */
  function svgDefs(){
    return `
      <defs>
        <marker id="arrow" markerWidth="8" markerHeight="8" refX="5" refY="4" orient="auto" markerUnits="strokeWidth">
          <path d="M0,0 L0,8 L8,4 z" fill="#ffffff" stroke="#000" stroke-width="0.5"></path>
        </marker>
        <marker id="arrowAlt" markerWidth="8" markerHeight="8" refX="5" refY="4" orient="auto" markerUnits="strokeWidth">
          <path d="M0,0 L0,8 L8,4 z" fill="#ffeb3b" stroke="#000" stroke-width="0.5"></path>
        </marker>
      </defs>
    `;
  }

  /* ===== Plays (10) ===== */
  function ply_SINGLE_SET_2(fmt){
    const s=[];
    s.push(...segs(R.OUT10,"WR1"));
    s.push(...segs(R.C_SIT,"C"));
    if(fmt>=6) s.push(...segs(R.SLANT,"WR3"));
    s.push(...segs(R.CORNER,"WR2"));
    s.push(...segs(R.FLAT,"RB"));
    if(fmt>=7) s.push(...segs(R.POST,"Flex"));
    return s.map((d,i)=>`<path d="${d}" class="route${i%2?' alt':''}"></path>`).join('');
  }
  function ply_DOUBLE_BACK_1(fmt){
    const s=[];
    s.push(...segs(R.OUT10,"WR1"));
    s.push(...segs(R.C_SIT,"C"));
    if(fmt>=6) s.push(...segs(R.CROSS_BEHIND,"WR3")); // That sweet cross behind play!
    s.push(...segs(R.CORNER,"WR2"));
    s.push(...segs(R.SWING,"RB"));
    if(fmt>=7) s.push(...segs(R.CHECK,"Flex"));
    return s.map((d,i)=>`<path d="${d}" class="route${i%2?' alt':''}"></path>`).join('');
  }
  function ply_DOUBLE_BACK_3(fmt){
    const s=[];
    s.push(...segs(R.FLY,"WR1"));
    s.push(...segs(R.C_SLANT,"C"));
    if(fmt>=6) s.push(...segs(R.SLANT,"WR3"));
    s.push(...segs(R.OUT10,"WR2"));
    s.push(...segs(R.FLAT,"RB"));
    if(fmt>=7) s.push(...segs(R.POST,"Flex"));
    return s.map((d,i)=>`<path d="${d}" class="route${i%2?' alt':''}"></path>`).join('');
  }
  function ply_SMASH(fmt){
    const s=[];
    s.push(...segs(R.HITCH,"WR1"));
    if(fmt>=6) s.push(...segs(R.CORNER,"WR3"));
    s.push(...segs(R.HITCH,"WR2"));
    s.push(...segs(R.FLAT,"RB"));
    s.push(...segs(R.C_SIT,"C"));
    if(fmt>=7) s.push(...segs(R.FLY,"Flex"));
    return s.map((d,i)=>`<path d="${d}" class="route${i%2?' alt':''}"></path>`).join('');
  }
  function ply_FLOOD(fmt){
    const s=[];
    s.push(...segs(R.CORNER,"WR2"));        // high
    if(fmt>=6) s.push(...segs(R.OUT10,"WR3")); // mid
    s.push(...segs(R.FLAT,"RB"));           // low
    s.push(...segs(R.SLANT,"WR1"));         // backside
    s.push(...segs(R.C_SIT,"C"));
    if(fmt>=7) s.push(...segs(R.CHECK,"Flex"));
    return s.map((d,i)=>`<path d="${d}" class="route${i%2?' alt':''}"></path>`).join('');
  }
  function ply_QUICK_SLANTS(fmt){
    const s=[];
    s.push(...segs(R.SLANT,"WR1"));
    if(fmt>=6) s.push(...segs(R.SLANT,"WR3"));
    s.push(...segs(R.SLANT,"WR2"));
    s.push(...segs(R.C_SIT,"C"));
    s.push(...segs(R.CHECK,"RB"));
    if(fmt>=7) s.push(...segs(R.SLANT,"Flex"));
    return s.map((d,i)=>`<path d="${d}" class="route${i%2?' alt':''}"></path>`).join('');
  }
  function ply_LEVELS(fmt){
    const s=[];
    s.push(...segs(R.POST,"WR1"));
    if(fmt>=6) s.push(...segs(R.OUT10,"WR3"));
    s.push(...segs(R.FLAT,"RB"));
    s.push(...segs(R.FLY,"WR2"));
    s.push(...segs(R.C_SIT,"C"));
    if(fmt>=7) s.push(...segs(R.CORNER,"Flex"));
    return s.map((d,i)=>`<path d="${d}" class="route${i%2?' alt':''}"></path>`).join('');
  }
  function ply_DRIVE(fmt){
    const s=[];
    s.push(...segs(R.SLANT,"WR1"));
    if(fmt>=6) s.push(...segs(R.OUT10,"WR3"));
    s.push(...segs(R.POST,"WR2"));
    s.push(...segs(R.SWING,"RB"));
    s.push(...segs(R.C_SIT,"C"));
    if(fmt>=7) s.push(...segs(R.FLY,"Flex"));
    return s.map((d,i)=>`<path d="${d}" class="route${i%2?' alt':''}"></path>`).join('');
  }
  function ply_WHEEL_SHOT(fmt){
    const s=[];
    s.push(...segs(R.OUT10,"WR1"));
    if(fmt>=6) s.push(...segs(R.SLANT,"WR3"));
    s.push(...segs(R.FLY,"WR2"));
    s.push(...segs(R.WHEEL,"RB"));
    s.push(...segs(R.C_SIT,"C"));
    if(fmt>=7) s.push(...segs(R.POST,"Flex"));
    return s.map((d,i)=>`<path d="${d}" class="route${i%2?' alt':''}"></path>`).join('');
  }
  function ply_STICK(fmt){
    const s=[];
    s.push(...segs(R.HITCH,"WR1"));
    if(fmt>=6) s.push(...segs(R.OUT10,"WR3"));
    s.push(...segs(R.CORNER,"WR2"));
    s.push(...segs(R.FLAT,"RB"));
    s.push(...segs(R.C_SIT,"C"));
    if(fmt>=7) s.push(...segs(R.HITCH,"Flex"));
    return s.map((d,i)=>`<path d="${d}" class="route${i%2?' alt':''}"></path>`).join('');
  }

  const PLAYS = [
    {name:"Single Set 2",  render:ply_SINGLE_SET_2},
    {name:"Double Back 1", render:ply_DOUBLE_BACK_1},
    {name:"Double Back 3", render:ply_DOUBLE_BACK_3},
    {name:"Smash",         render:ply_SMASH},
    {name:"Flood",         render:ply_FLOOD},
    {name:"Quick Slants",  render:ply_QUICK_SLANTS},
    {name:"Levels",        render:ply_LEVELS},
    {name:"Drive",         render:ply_DRIVE},
    {name:"Wheel Shot",    render:ply_WHEEL_SHOT},
    {name:"Stick",         render:ply_STICK}
  ];

  /* ===== Rotation: bench-group subs + position rotation ===== */
  function rotationRows(roster, fmt){
    const keys = keysForFormat(fmt);
    const on = keys.length;                         
    const benchCount = Math.max(0, roster - on);    
    const players = Array.from({length: roster}, (_,i)=> i+1);

    const groups = [];
    if(benchCount===0){ groups.push([]); }
    else{
      for(let i=0;i<roster;i+=benchCount) groups.push(players.slice(i, i+benchCount));
    }
    const G = groups.length;

    const rows = [];
    for(let s=0; s<Math.max(roster, G); s++){
      const bench = groups[s % G];
      const active = players.filter(p=> !bench.includes(p));
      const rotated = active.map((_,i)=> active[(i + s) % active.length]);
      const lineup = {};
      for(let i=0;i<keys.length;i++) lineup[keys[i]] = rotated[i];
      rows.push({series:s+1, lineup, bench:[...bench]});
    }
    return rows;
  }

  /* ===== UI helpers ===== */
  function buildInitials(){
    const n = parseInt($("#roster").value,10);
    const box = $("#initials"); box.innerHTML="";
    for(let i=1;i<=n;i++){
      const inp=document.createElement("input");
      inp.placeholder="#"+i+" ABC"; inp.id="init-"+i; inp.maxLength=3; inp.style.width="78px";
      box.appendChild(inp);
    }
  }
  function initialsMap(){
    const n = parseInt($("#roster").value,10), map={};
    for(let i=1;i<=n;i++){ map[i]=($("#init-"+i)?.value||"").toUpperCase().slice(0,3); }
    return map;
  }
  function mirroredX(x){ return ($("#mirror").value==="L") ? (600 - x) : x; }
  function Pkey(key){ const p=POS_BASE.find(pp=>pp.key===key); return {...p, x:mirroredX(p.x)}; }

  function playerBubble(posKey, label){
    const p = Pkey(posKey);
    const displayLabel = p.displayName;
    return `
      <circle cx="${p.x}" cy="${p.y}" r="16" class="player" fill="${p.color}"></circle>
      <text x="${p.x}" y="${p.y+4}" text-anchor="middle" class="bubble">${label}</text>
      <text x="${p.x}" y="${p.y+18}" text-anchor="middle" class="role-lbl">${displayLabel}</text>
    `;
  }

  let currentSeries = 1;

  function renderBoard(){
    const fmt = parseInt($("#format").value,10);
    const roster = parseInt($("#roster").value,10);
    const idMode = $("#idMode").value;
    const init = initialsMap();
    const rows = rotationRows(roster, fmt);
    if(currentSeries>rows.length) currentSeries=1;
    const row = rows[currentSeries-1];
    $("#meta").textContent = `Series ${currentSeries} of ${rows.length} • Bench this series: ${row.bench.join(", ")||"—"}`;

    const grid=$("#assignGrid"); grid.innerHTML="";
    keysForFormat(fmt).forEach(pos=>{
      const num=row.lineup[pos];
      const label=(idMode==="initials" && init[num])? init[num] : (idMode==="off"?"":num);
      const p = POS_BASE.find(pp=>pp.key===pos);
      const tile=document.createElement("div");
      tile.className="tile role-"+pos;
      tile.innerHTML=`<h4>${p.displayName}</h4><div class="big">${label}</div>`;
      grid.appendChild(tile);
    });
    $("#benchRow").textContent = row.bench.length ? "Bench: "+row.bench.join(", ") : "Bench: —";
  }

  function renderPlays(){
    const fmt = parseInt($("#format").value,10);
    const roster = parseInt($("#roster").value,10);
    const idMode = $("#idMode").value;
    const init = initialsMap();
    const rows = rotationRows(roster, fmt);
    if(currentSeries>rows.length) currentSeries=1;
    const row = rows[currentSeries-1];

    const grid=$("#playGrid"); grid.innerHTML="";
    PLAYS.forEach(p=>{
      const bubbles = keysForFormat(fmt).map(k=>{
        const num = row.lineup[k];
        const label=(idMode==="initials" && init[num])? init[num] : (idMode==="off"?"":num);
        return playerBubble(k,label);
      }).join("");

      const routes = p.render(fmt);
      const card=document.createElement("div");
      card.className="panel";
      card.innerHTML=`
        <h3 style="margin:4px 0">${p.name}</h3>
        <div class="field-wrap"><div class="field"><div class="sideline"></div>
          <svg viewBox="0 0 600 400">
            ${svgDefs()}
            ${bubbles}
            ${routes}
          </svg>
        </div></div>
      `;
      grid.appendChild(card);
    });
  }

  function renderRotation(){
    const fmt = parseInt($("#format").value,10);
    const roster = parseInt($("#roster").value,10);
    const rows = rotationRows(roster, fmt);
    const pkeys = keysForFormat(fmt);
    const displayNames = pkeys.map(k=>POS_BASE.find(p=>p.key===k).displayName);
    let html = `<table><thead><tr><th>Series</th>${displayNames.map(p=>`<th>${p}</th>`).join("")}<th>Bench</th></tr></thead><tbody>`;
    rows.forEach(r=>{
      html += `<tr><td>${r.series}</td>${pkeys.map(p=>`<td>${r.lineup[p]||""}</td>`).join("")}<td>${r.bench.join(", ")||"-"}</td></tr>`;
    });
    html += `</tbody></table>`;
    $("#rotationTable").innerHTML=html;
  }

  function renderAll(){ renderBoard(); renderPlays(); renderRotation(); }

  // Tabs
  $$(".tab").forEach(btn=>btn.addEventListener("click", ()=>{
    $$(".tab").forEach(b=>b.classList.remove("active"));
    btn.classList.add("active");
    ["board","plays","rotations","tips"].forEach(id=>$("#"+id).style.display="none");
    $("#"+btn.dataset.tab).style.display="block";
    if(btn.dataset.tab==="rotations") renderRotation();
    if(btn.dataset.tab==="plays") renderPlays();
    if(btn.dataset.tab==="board") renderBoard();
  }));

  // Controls
  $("#format").addEventListener("change", ()=>{ currentSeries=1; renderAll(); });
  $("#roster").addEventListener("change", ()=>{ buildInitials(); currentSeries=1; renderAll(); });
  $("#idMode").addEventListener("change", renderAll);
  $("#mirror").addEventListener("change", renderAll);
  $("#nextBtn").addEventListener("click", ()=>{ currentSeries++; const r=parseInt($("#roster").value,10); if(currentSeries>r) currentSeries=1; renderAll(); });
  $("#prevBtn").addEventListener("click", ()=>{ currentSeries--; const r=parseInt($("#roster").value,10); if(currentSeries<1) currentSeries=r; renderAll(); });

  // Init
  buildInitials();
  renderAll();
</script>
</body>
</html>
